<!DOCTYPE html>
<html>
<head>
    <title>Generate Screenshots</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        .screenshot-container {
            width: 375px;
            height: 812px;
            margin: 20px;
            border: 2px solid #333;
            border-radius: 20px;
            overflow: hidden;
            background: black;
            display: inline-block;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .download-btn {
            margin: 10px;
            padding: 10px 20px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .status {
            margin: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Zivora App Store Screenshots Generator</h1>
    
    <div class="status" id="status">
        Click "Generate All Screenshots" to create and download all images as a zip file.
    </div>
    
    <button class="download-btn" onclick="generateAllScreenshots()">Generate All Screenshots</button>
    <button class="download-btn" onclick="downloadZip()">Download ZIP</button>
    
    <div id="screenshots-area"></div>
    
    <script>
        const screenshots = [
            { name: '1-onboarding-brain-anatomy', url: 'https://3ee4d6a9-e442-4a38-b9d4-69a8bb496f55-00-2spibzzix19bx.janeway.replit.dev/mobile-onboarding' },
            { name: '2-symptom-recognition', url: 'https://3ee4d6a9-e442-4a38-b9d4-69a8bb496f55-00-2spibzzix19bx.janeway.replit.dev/mobile-onboarding-2' },
            { name: '3-risk-analytics', url: 'https://3ee4d6a9-e442-4a38-b9d4-69a8bb496f55-00-2spibzzix19bx.janeway.replit.dev/mobile-onboarding-3' },
            { name: '4-authentication', url: 'https://3ee4d6a9-e442-4a38-b9d4-69a8bb496f55-00-2spibzzix19bx.janeway.replit.dev/login' },
            { name: '5-dashboard-risk-monitoring', url: 'https://3ee4d6a9-e442-4a38-b9d4-69a8bb496f55-00-2spibzzix19bx.janeway.replit.dev/dashboard' },
            { name: '6-daily-health-tracking', url: 'https://3ee4d6a9-e442-4a38-b9d4-69a8bb496f55-00-2spibzzix19bx.janeway.replit.dev/daily-log' },
            { name: '7-ai-insights', url: 'https://3ee4d6a9-e442-4a38-b9d4-69a8bb496f55-00-2spibzzix19bx.janeway.replit.dev/insights' },
            { name: '8-history-trends', url: 'https://3ee4d6a9-e442-4a38-b9d4-69a8bb496f55-00-2spibzzix19bx.janeway.replit.dev/history' }
        ];
        
        let generatedImages = [];
        
        // First authenticate
        fetch('https://3ee4d6a9-e442-4a38-b9d4-69a8bb496f55-00-2spibzzix19bx.janeway.replit.dev/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: 'demo@zivora.com', password: 'demo123' })
        }).then(response => response.json())
        .then(data => {
            if (data.token) {
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                console.log('Authenticated for screenshots');
            }
        });
        
        async function generateAllScreenshots() {
            document.getElementById('status').innerHTML = 'Generating screenshots... Please wait.';
            generatedImages = [];
            
            const screenshotArea = document.getElementById('screenshots-area');
            screenshotArea.innerHTML = '';
            
            for (let i = 0; i < screenshots.length; i++) {
                const screenshot = screenshots[i];
                await generateSingleScreenshot(screenshot, i);
                await new Promise(resolve => setTimeout(resolve, 2000)); // Wait between screenshots
            }
            
            document.getElementById('status').innerHTML = `Generated ${generatedImages.length} screenshots. Click "Download ZIP" to get them all.`;
        }
        
        async function generateSingleScreenshot(screenshot, index) {
            return new Promise((resolve) => {
                const container = document.createElement('div');
                container.className = 'screenshot-container';
                container.style.position = 'relative';
                
                const iframe = document.createElement('iframe');
                iframe.src = screenshot.url;
                iframe.style.width = '375px';
                iframe.style.height = '812px';
                
                container.appendChild(iframe);
                document.getElementById('screenshots-area').appendChild(container);
                
                iframe.onload = () => {
                    setTimeout(() => {
                        // Convert to canvas and capture
                        html2canvas(container, {
                            width: 375,
                            height: 812,
                            useCORS: true,
                            allowTaint: true,
                            scale: 2
                        }).then(canvas => {
                            canvas.toBlob(blob => {
                                generatedImages.push({
                                    name: screenshot.name + '.png',
                                    blob: blob
                                });
                                
                                // Add download link
                                const link = document.createElement('a');
                                link.href = URL.createObjectURL(blob);
                                link.download = screenshot.name + '.png';
                                link.textContent = `Download ${screenshot.name}.png`;
                                link.style.display = 'block';
                                link.style.margin = '5px';
                                container.appendChild(link);
                                
                                resolve();
                            }, 'image/png', 1.0);
                        }).catch(err => {
                            console.error('Screenshot failed:', err);
                            resolve();
                        });
                    }, 3000);
                };
            });
        }
        
        async function downloadZip() {
            if (generatedImages.length === 0) {
                alert('Please generate screenshots first!');
                return;
            }
            
            // Create a simple zip-like structure (actually just individual downloads)
            generatedImages.forEach((img, index) => {
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(img.blob);
                    link.download = img.name;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }, index * 500);
            });
            
            document.getElementById('status').innerHTML = 'Downloading all screenshots individually...';
        }
    </script>
</body>
</html>